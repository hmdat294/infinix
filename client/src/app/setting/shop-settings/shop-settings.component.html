<div class="w-fill h-fill layout-vertical gap-20 overflow-scroll-vertical">

    <div class="layout-vertical w-fill gap-20 mb-20">

        <div class="layout-vertical w-fill gap-5">
            <p class="text-body-strong text-primary">Cửa hàng</p>


            <div class="accordion active border border-card-default card-background-default rounded-6">
                <div class="accordion-item">
                    <div class="accordion-header layout-horizontal gap-15 p-15 align-center-center"
                        (click)="tabChild('create_shop')">
                        <i class="icon-size-20 icon text-primary icon-ic_fluent_person_lock_20_regular"></i>
                        <div class="layout-vertical w-fill">
                            <p class="text-body text-primary">Cửa hàng của bạn</p>
                        </div>
                        <button type="button" class="button-subtle button-icon-only">
                            <span [class]="tabAccordion == 'create_shop' ? 'rotate_icon_180' : 'rotate_icon_0'">
                                <i class="icon-size-20 icon open-icon icon-ic_fluent_chevron_down_20_filled"></i>
                            </span>
                        </button>
                    </div>

                    <div class="accordion-panel open create_shop">

                        <form *ngIf="this.user?.shop_id == null" class="layout-vertical p-20 gap-20"
                            (submit)="createShop(shop.value)" #shop="ngForm">

                            <div class="layout-horizontal gap-20 w-fill">
                                <div class="layout align-center-center" style="width: 200px;">
                                    <div class="background-card-default " style="width: 70px; height: 70px;">
                                        <img class="border border-card-default w-fill h-fill rounded-circle object-fit-cover"
                                            src="{{(selectedFilesLogo.length > 0)?previewLogo:'http://localhost:8000/storage/uploads/default-profile-photo.png'}}"
                                            alt="">

                                        <input class="display-none" type="file" [ngModel]="fileLogo" name="fileLogo"
                                            (change)="onFileLogoSelected($event)" accept="image/*" id="logo_input">
                                        <label for="logo_input"
                                            class="p-0 button-accent button-icon-only position-absolute bottom-0 end-0"
                                            style="z-index: 1;">
                                            <i class="icon-size-16 icon icon-ic_fluent_camera_16_filled"></i>
                                        </label>
                                    </div>
                                </div>

                                <div class="w-fill layout-horizontal gap-20">
                                    <div class="w-fill-column-8 layout-vertical gap-5">
                                        <p class="text-body text-primary">Tên cửa hàng</p>
                                        <div class="w-fill control text-control">
                                            <input type="text" spellcheck="false" name="name" ngModel required>
                                        </div>
                                    </div>
                                    <div class="w-fill layout-vertical gap-5">
                                        <p class="text-body text-primary">Số điện thoại</p>
                                        <div class="control text-control w-fill">
                                            <input type="text" spellcheck="false" name="phone_number" ngModel required>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="w-fill layout-vertical gap-5">
                                <p class="text-body text-primary">Mô tả</p>
                                <textarea style="min-height: 110px;" class="control text-area-control w-fill"
                                    spellcheck="false" name="description" ngModel required></textarea>
                            </div>



                            <div class="layout-horizontal gap-20 align-center-space-between">
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Tỉnh/Thành phố</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="province" ngModel required>
                                    </div>
                                </div>
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Quận/Huyện</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="district" ngModel required>
                                    </div>
                                </div>
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Phường/Xã</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="ward" ngModel required>
                                    </div>
                                </div>
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Số nhà/Chi tiết</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="detail" ngModel required>
                                    </div>
                                </div>
                            </div>

                            <div class="layout-horizontal align-center-right">
                                <button type="submit" class="button-accent button-text-only" [disabled]="shop.invalid">
                                    Tạo cửa hàng
                                </button>
                            </div>
                        </form>

                        <form *ngIf="user?.shop_id > 0" [class]="is_update_shop?'update-shop':''"
                            class="layout-vertical p-20 gap-20" (submit)="updateShop(shopUpdate.value)"
                            #shopUpdate="ngForm">

                            <div class="layout-horizontal gap-20 w-fill">
                                <div class="layout align-center-center" style="width: 200px;">
                                    <div class="background-card-default " style="width: 70px; height: 70px;">
                                        <img class="border border-card-default w-fill h-fill rounded-circle object-fit-cover"
                                            [src]="(selectedFilesUpdateLogo.length > 0)?previewUpdateLogo:shop?.logo"
                                            alt="">

                                        <input class="display-none" type="file" [ngModel]="fileUpdateLogo"
                                            name="fileUpdateLogo" (change)="onFileUpdateLogoSelected($event)"
                                            accept="image/*" id="logo_update_input" [disabled]="is_update_shop">
                                        <label for="logo_update_input"
                                            class="p-0 button-accent button-icon-only position-absolute bottom-0 end-0"
                                            style="z-index: 1;">
                                            <i class="icon-size-16 icon icon-ic_fluent_camera_16_filled"></i>
                                        </label>
                                    </div>
                                </div>

                                <div class="w-fill layout-horizontal gap-20">
                                    <div class="w-fill-column-8 layout-vertical gap-5">
                                        <p class="text-body text-primary">Tên cửa hàng</p>
                                        <div class="w-fill control text-control">
                                            <input type="text" spellcheck="false" name="name" [ngModel]="shop?.name"
                                                required [disabled]="is_update_shop">
                                        </div>
                                    </div>
                                    <div class="w-fill layout-vertical gap-5">
                                        <p class="text-body text-primary">Số điện thoại</p>
                                        <div class="control text-control w-fill">
                                            <input type="text" spellcheck="false" name="phone_number"
                                                [ngModel]="shop?.phone_number" required [disabled]="is_update_shop">
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="w-fill layout-vertical gap-5">
                                <p class="text-body text-primary">Mô tả</p>
                                <textarea style="min-height: 110px;" class="control text-area-control w-fill"
                                    spellcheck="false" name="description" [ngModel]="shop?.description" required
                                    [disabled]="is_update_shop"></textarea>
                            </div>



                            <div class="layout-horizontal gap-20 align-center-space-between">
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Tỉnh/Thành phố</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="province" [ngModel]="province"
                                            required [disabled]="is_update_shop">
                                    </div>
                                </div>
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Quận/Huyện</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="district" [ngModel]="district"
                                            required [disabled]="is_update_shop">
                                    </div>
                                </div>
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Phường/Xã</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="ward" [ngModel]="ward" required
                                            [disabled]="is_update_shop">
                                    </div>
                                </div>
                                <div class="w-fill-column-3 layout-vertical gap-5">
                                    <p class="text-body text-primary">Số nhà/Chi tiết</p>
                                    <div class="control text-control w-fill">
                                        <input type="text" spellcheck="false" name="detail" [ngModel]="detail" required
                                            [disabled]="is_update_shop">
                                    </div>
                                </div>
                            </div>

                            <div class="layout-horizontal align-center-right gap-20">
                                <button type="button" class="button-standard button-text-only"
                                    (click)="is_update_shop = !is_update_shop">
                                    {{is_update_shop?'Chỉnh sửa thông tin':'Hủy'}}
                                </button>
                                <button type="submit" class="button-accent button-text-only"
                                    [disabled]="shopUpdate.invalid" *ngIf="!is_update_shop">
                                    Cập nhật
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>

        </div>

        <div class="layout-vertical">
            <div class="layout-horizontal align-center-left">
                <button type="button" class="list-item tab-shop text-primary w-hug"
                    [class]="tab_shop == 'tab_category'?'tab-shop-active':''" [disabled]="tab_shop == 'tab_category'"
                    (click)="tabShop('tab_category')">
                    Danh mục
                </button>
                <button type="button" class="list-item tab-shop text-primary w-hug"
                    [class]="tab_shop == 'tab_product'?'tab-shop-active':''" [disabled]="tab_shop == 'tab_product'"
                    (click)="tabShop('tab_product')">
                    Sản phẩm
                </button>
            </div>

            <div *ngIf="user?.shop_id > 0 && tab_shop == 'tab_category'" class="ayout-vertical w-fill">
                <div class="border border-card-default card-background-default rounded-bottom-6 pt-10 pb-20 px-20">
                    <table class="text-primary text-center w-fill">
                        <tr class="">
                            <th style="width: 50px;">STT</th>
                            <th class="w-fill">Tên</th>
                            <th class="w-hug">#</th>
                        </tr>
                        <!-- for -->
                        <tr class="border-top border-card-default"
                            *ngFor="let cate of shop?.categories; let i = index;">
                            <td>{{i+1}}</td>
                            <td class="text-body-strong">{{cate.name}}</td>
                            <td class="layout-horizontal gap-10">
                                <button type="button" class="button-standard button-icon-only"
                                    (click)="showDiaLogUpdateCategory(cate.id, cate.name)">
                                    <i class="icon-size-16 icon icon-ic_fluent_edit_16_filled"></i>
                                </button>
                                <button type="button" class="button-standard button-icon-only"
                                    (click)="showDiaLogDeleteCategory(cate.id)">
                                    <i class="icon-size-16 icon icon-ic_fluent_delete_16_filled"></i>
                                </button>
                            </td>
                        </tr>
                    </table>
                    <div>
                        <button type="button" class="button-standard button-text-only w-fill"
                            (click)="showDiaLogCreateCategory()">
                            <i class="me-5 icon-size-16 icon icon-ic_fluent_add_16_regular"></i>
                            Thêm danh mục</button>
                    </div>


                    <div class="position-fixed top-0 start-0 {{(diaLogCreateCategory) ? 'display-block' : 'display-none'}}"
                        style="width: 100%; height: 100vh; z-index: 20;">
                        <div class="position-absolute top-0 start-0" (click)="showDiaLogCreateCategory()"
                            style="width: 100%; height: 100vh; z-index: 1; background-color: rgba(0, 0, 0, 0.2); backdrop-filter: blur(2px);">
                        </div>
                        <div class="dialog-panel position-absolute top-50 start-50 translate-middle"
                            style="z-index: 2;">
                            <div class="layout-vertical p-20 gap-20 rounded-8 solid-background-base border border-card-default"
                                style="width: 500px;">

                                <button type="button" class="button-subtle button-icon-only w-hug position-absolute"
                                    (click)="showDiaLogCreateCategory()" style="right: 20px; top: 20px; z-index: 1;">
                                    <i class="icon-size-16 icon icon-ic_fluent_dismiss_16_filled"></i>
                                </button>

                                <div class="pb-20 pt-5 border-bottom">
                                    <p class="text-subtitle text-primary text-center">Thêm danh mục</p>
                                </div>

                                <div class="layout-vertical overflow-hidden">
                                    <div class="layout-horizontal gap-20">
                                        <div class="w-fill control text-control">
                                            <input type="text" spellcheck="false" name="name_category"
                                                [(ngModel)]="name_category" required>
                                        </div>

                                        <button type="button" class="button-accent button-text-only w-hug"
                                            (click)="createCategory()">
                                            Thêm</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="position-fixed top-0 start-0 {{(id_cate_update != 0) ? 'display-block' : 'display-none'}}"
                        style="width: 100%; height: 100vh; z-index: 20;">
                        <div class="position-absolute top-0 start-0" (click)="showDiaLogUpdateCategory(0)"
                            style="width: 100%; height: 100vh; z-index: 1; background-color: rgba(0, 0, 0, 0.2); backdrop-filter: blur(2px);">
                        </div>
                        <div class="dialog-panel position-absolute top-50 start-50 translate-middle"
                            style="z-index: 2;">
                            <div class="layout-vertical p-20 gap-20 rounded-8 solid-background-base border border-card-default"
                                style="width: 500px;">

                                <button type="button" class="button-subtle button-icon-only w-hug position-absolute"
                                    (click)="showDiaLogUpdateCategory(0)" style="right: 20px; top: 20px; z-index: 1;">
                                    <i class="icon-size-16 icon icon-ic_fluent_dismiss_16_filled"></i>
                                </button>

                                <div class="pb-20 pt-5 border-bottom">
                                    <p class="text-subtitle text-primary text-center">Sửa danh mục</p>
                                </div>

                                <div class="layout-vertical overflow-hidden">
                                    <div class="layout-horizontal gap-20">
                                        <div class="w-fill control text-control">
                                            <input type="text" spellcheck="false" name="name_cate_update"
                                                [(ngModel)]="name_cate_update" required>
                                        </div>

                                        <button type="button" class="button-accent button-text-only w-hug"
                                            (click)="updateCategory()">
                                            Sửa</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="position-fixed top-0 start-0 {{(id_cate_delete != 0) ? 'display-block' : 'display-none'}}"
                        style="width: 100%; height: 100vh; z-index: 20;">
                        <div class="position-absolute top-0 start-0" (click)="showDiaLogDeleteCategory(0)"
                            style="width: 100%; height: 100vh; z-index: 1; background-color: rgba(0, 0, 0, 0.2); backdrop-filter: blur(2px);">
                        </div>
                        <div class="dialog-panel position-absolute top-50 start-50 translate-middle"
                            style="z-index: 2;">
                            <div class="layout-vertical p-20 gap-20 rounded-8 solid-background-base border border-card-default"
                                style="width: 500px;">

                                <button type="button" class="button-subtle button-icon-only w-hug position-absolute"
                                    (click)="showDiaLogDeleteCategory(0)" style="right: 20px; top: 20px; z-index: 1;">
                                    <i class="icon-size-16 icon icon-ic_fluent_dismiss_16_filled"></i>
                                </button>

                                <div class="pb-20 pt-5 border-bottom">
                                    <p class="text-subtitle text-primary text-center">Xóa danh mục</p>
                                </div>

                                <div class="layout-vertical overflow-hidden">
                                    <div class="layout-horizontal gap-20">
                                        <button type="button" class="button-standard button-text-only w-fill"
                                            (click)="showDiaLogDeleteCategory(0)">
                                            Hủy</button>

                                        <button type="button" class="button-accent button-text-only w-fill"
                                            (click)="deleteCategory()">
                                            Xóa</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="user?.shop_id > 0 && tab_shop == 'tab_product'" class="layout-vertical w-fill">
                <div class="border border-card-default card-background-default rounded-bottom-6 pt-10 pb-20 px-20">
                    <table class="text-primary text-center w-fill">
                        <tr>
                            <th style="width: 50px;">STT</th>
                            <th>Hình ảnh</th>
                            <th>Tên</th>
                            <th>Số lượng</th>
                            <th>Giá</th>
                            <th class="w-hug">#</th>
                        </tr>
                        <tr class="border-top border-card-default" *ngFor="let product of products">
                            <td>1</td>
                            <td><img src="assets/image/hinh.jpg" alt="" style="height: 50px; width: 50px;"
                                    class="object-fit-cover rounded-4"></td>
                            <td class="text-body-strong">
                                {{shortenTextByWords(
                                'Quần short nam', 5
                                )}}
                            </td>
                            <td class="text-body">1</td>
                            <td class="text-body">{{ 5000000 | currencyVND }}</td>
                            <td class="layout-horizontal align-center-right gap-10 my-10">
                                <button type="button" class="button-standard button-icon-only">
                                    <i class="icon-size-16 icon icon-ic_fluent_edit_16_filled"></i>
                                </button>
                                <button type="button" class="button-standard button-icon-only">
                                    <i class="icon-size-16 icon icon-ic_fluent_delete_16_filled"></i>
                                </button>
                            </td>
                        </tr>
                    </table>
                    <div>
                        <button type="button" class="button-standard button-text-only w-fill"
                            (click)="showDiaLogCreateProduct()">
                            <i class="me-5 icon-size-16 icon icon-ic_fluent_add_16_regular"></i>
                            Thêm sản phẩm</button>
                    </div>

                    <div class="position-fixed top-0 start-0 {{(diaLogCreateProduct) ? 'display-block' : 'display-none'}}"
                        style="width: 100%; height: 100vh; z-index: 20;">
                        <div class="position-absolute top-0 start-0" (click)="showDiaLogCreateProduct()"
                            style="width: 100%; height: 100vh; z-index: 1; background-color: rgba(0, 0, 0, 0.2); backdrop-filter: blur(2px);">
                        </div>
                        <div class="dialog-panel position-absolute top-50 start-50 translate-middle"
                            style="z-index: 2;">
                            <div class="layout-vertical p-20 gap-20 rounded-8 solid-background-base border border-card-default"
                                style="width: 700px;">

                                <button type="button" class="button-subtle button-icon-only w-hug position-absolute"
                                    (click)="showDiaLogCreateProduct()" style="right: 20px; top: 20px; z-index: 1;">
                                    <i class="icon-size-16 icon icon-ic_fluent_dismiss_16_filled"></i>
                                </button>

                                <div class="pb-20 pt-5 border-bottom">
                                    <p class="text-subtitle text-primary text-center">Thêm sản phẩm</p>
                                </div>

                                <div class="layout-vertical overflow-hidden">

                                    <form class="layout-vertical gap-25 w-fill" enctype="multipart/form-data"
                                        #frm_product="ngForm" (submit)="createProduct(frm_product.value)">

                                        <div class="layout-horizontal gap-20 align-center-space-between">

                                            <div class="w-fill-column-6 layout-vertical gap-5">
                                                <p class="text-body text-primary">Tên sản phẩm</p>
                                                <div class="control text-control w-fill">
                                                    <input type="text" spellcheck="false" name="name_product" ngModel
                                                        [(ngModel)]="name_product" required>
                                                </div>
                                            </div>

                                            <div class="w-fill-column-6 layout-vertical gap-5">
                                                <p class="text-body text-primary">Danh mục</p>
                                                <select class="control w-fill" name="category_id_product" ngModel>
                                                    <option *ngFor="let cate of shop?.categories; let i = index"
                                                        [value]="cate.id" [selected]="i == 0">
                                                        {{cate.name}}</option>
                                                </select>
                                            </div>

                                        </div>

                                        <div class="w-fill layout-vertical gap-5">
                                            <p class="text-body text-primary">Mô tả</p>
                                            <textarea style="min-height: 110px;"
                                                class="control text-area-control w-fill" spellcheck="false"
                                                name="description_product" ngModel [(ngModel)]="description_product"
                                                required></textarea>
                                        </div>

                                        <div class="layout-horizontal gap-20 align-center-space-between">

                                            <div class="w-fill-column-6 layout-vertical gap-5">
                                                <p class="text-body text-primary">Giá</p>
                                                <div class="control text-control w-fill">
                                                    <input type="number" min="0" spellcheck="false" name="price_product"
                                                        ngModel [(ngModel)]="price_product" required>
                                                </div>
                                                <div *ngIf="price_product < 0"
                                                    class="text-caption position-absolute top-100 mt-5 text-system-critical">
                                                    Giá trị phải lớn hơn hoặc bằng 0.
                                                </div>
                                            </div>

                                            <div class="w-fill-column-6 layout-vertical gap-5">
                                                <p class="text-body text-primary">Giảm giá</p>
                                                <div class="control text-control w-fill">
                                                    <input type="number" min="0" max="100" spellcheck="false"
                                                        name="discount_product" ngModel [(ngModel)]="discount_product"
                                                        required>
                                                </div>
                                                <div *ngIf="discount_product < 0 || discount_product > 100"
                                                    class="text-caption position-absolute top-100 mt-5 text-system-critical">
                                                    Giá trị phải nằm trong khoảng từ 0 đến 100.
                                                </div>
                                            </div>

                                        </div>

                                        <div class="layout-horizontal gap-20 align-bottom-space-between">
                                            <div class="w-fill-column-6 layout-vertical gap-5">
                                                <p class="text-body text-primary">Số lượng</p>
                                                <div class="control text-control w-fill">
                                                    <input type="number" min="1" spellcheck="false" name="stock_product"
                                                        ngModel [(ngModel)]="stock_product" required>
                                                </div>
                                                <div *ngIf="stock_product < 1"
                                                    class="text-caption position-absolute top-100 mt-5 text-system-critical">
                                                    Giá trị phải lớn hơn 1.
                                                </div>
                                            </div>

                                            <div class="w-fill-column-3">
                                                <input class="display-none" type="file" [ngModel]="fileProduct"
                                                    name="fileProduct" (change)="onFileProductSelected($event)"
                                                    accept="image/*" id="product_media_input" multiple>
                                                <label for="product_media_input"
                                                    class="button-standard button-text-with-icon w-fill">
                                                    <i
                                                        class="me-5 icon-size-20 icon icon-ic_fluent_image_20_regular"></i>
                                                    Thêm ảnh
                                                </label>
                                            </div>

                                            <div
                                                class="w-fill-column-3 layout-horizontal gap-20 align-center-center py-5 px-10">
                                                <label class="label-radio-control">
                                                    <input class="radio-control" type="radio" name="is_active_product"
                                                        value="0" [(ngModel)]="is_active_product">
                                                    <span class="text-body text-primary">Ẩn</span>
                                                </label>
                                                <label class="label-radio-control">
                                                    <input class="radio-control" type="radio" name="is_active_product"
                                                        value="1" [(ngModel)]="is_active_product">
                                                    <span class="text-body text-primary">Hiện</span>
                                                </label>
                                            </div>

                                        </div>

                                        <div *ngIf="previewProductImages.length > 0"
                                            class="p-10 position-relative border rounded-6">
                                            <div class="layout-wrap gap-10 overflow-scroll-vertical"
                                                style="max-height: 200px;">
                                                <div *ngFor="let previewImage of previewProductImages; let i = index"
                                                    class="w-fill-column-4">
                                                    <img [src]="previewImage" alt="Image preview" width="100%"
                                                        class="rounded-4">
                                                    <button type="button" (click)="removeProductImage(i)"
                                                        class="button-standard button-icon-only position-absolute top-0 end-0">
                                                        <i
                                                            class="icon-size-16 icon icon-ic_fluent_dismiss_16_regular"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="layout-horizontal align-center-right w-fill">

                                            <button type="submit" class="button-accent button-text-with-icon"
                                                [disabled]="frm_product.invalid">
                                                Thêm
                                            </button>

                                        </div>
                                    </form>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>